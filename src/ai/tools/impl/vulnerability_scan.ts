import VulnerabilityScanner from '../../../services/vulnerability/VulnerabilityScanner';
import { ToolManager } from '../ToolManager';
import { ToolContext } from '../ToolTypes';

export const TOOL_VULNERABILITY_SCAN = 'vulnerability_scan';

/**
 * Write text to a file
 * @param filename The name of the file to write
 * @param contents The contents of the file to write
 */
const vulnerability_scan = async (context: ToolContext, project: string) => {
  const scanner = new VulnerabilityScanner();
  return scanner.scanAndReportOnRepo(context, project);
};

ToolManager.registerTool(vulnerability_scan, {
  name: TOOL_VULNERABILITY_SCAN,
  description: 'Scans a locally cloned code repository for vulnerabilities',
  parameters: {
    type: 'object',
    properties: {
      project: {
        type: 'string',
        description: 'The name of of the project to scan',
      },
    },
    required: ['project'],
  },
});
